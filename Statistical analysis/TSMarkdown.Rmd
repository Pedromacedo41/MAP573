---
title: "TS"
author: "Ari Jóhannesson"
date: "10/31/2019"
output: html_document
---
## Relationship between temperature and load

Read in the TS objects.We set the index as the dates and remove the time/date column and the X column. The temperature file has 11 zones and I assume that those 11 zones are the same as the first zones in the load TS.
```{r chunk0}
setwd("~/Documents/Skóli/École Polytechnique/Data Analysis and Unsupervised Learning /Project/Data")

TS <- read.csv("TS.csv")
TST <- read.csv("TST.csv")

row.names(TST) <- TST$datetime
TST = subset(TST, select = -c(X, datetime))

row.names(TS) <- TS$datetime
TS = subset(TS, select = -c(X, datetime))

TS <- TS[,1:11]

```

Because we have so many zones, we might want to simplify our data and only use the mean over the zones. If we do not do that, the temperature vs weight plot will have different clusters and the TS plot will also have more lines.

```{r chunk1}

Z <- t(as.matrix(TS))
TSstandardized <-  t(scale(Z, center = TRUE, scale = TRUE))
Z <- t(as.matrix(TST))
TSTstandardized <- t(scale(Z, center = TRUE, scale = TRUE))

TSmeans <- rowMeans(TS[1:29414, ])
TSmeans[1]
TSmeans_standardized <- rowMeans(TSstandardized[1:29414, ])

TSTmeans <- rowMeans(TST[1:29414, ])
TSTmeans[1]
TSTmeans_standardized <- rowMeans(TSTstandardized[1:29414, ])

data <- as.data.frame(cbind(TSTmeans, TSmeans))
data_standardized <- as.data.frame(cbind(TSTmeans_standardized, TSmeans_standardized))


```

We then plot the data. relationship between load and temperature can be seen. Maybe change temperature to C later on. Also, find out in what units the load is.

```{r chunk2}

plot(TSTmeans, TSmeans, 
     main = "Relationship between energy load and temperature", 
     xlab = "Temperature [F]", 
     ylab = "Load [xW]", 
     cex = 0.1,
     panel.first = grid(nx = NULL, ny = NULL, col = "red", lty = "dotted"))


plot(TSTmeans_standardized, TSmeans_standardized, 
     main = "Relationship between energy load and temperature (standardized)", 
     xlab = "Temperature", 
     ylab = "Load", 
     cex = 0.1,
     panel.first = grid(nx = NULL, ny = NULL, col = "red", lty = "dotted"))
```

## Time series analyis

We use the zoo library because the ts library does not support hourly collected data. First, the dates/hours are formatted and then a TS object is made out of them. This is done for both load and temperature.
Then the data is plotted. The y axis og the ggplot has to be changed so that the left axis shows W and the right shows temeprature f.x.
```{r chunk 3}
library(zoo)

times <- as.POSIXct(row.names(data), format = "%Y-%m-%d %H:%M:")
timesNAomit <- na.omit(times) 
load.ts <- zoo(
  x         = data$TSmeans,
  order.by  = timesNAomit,
  frequency = 24
)

temperature.ts <- zoo(
  x         = data$TSTmeans,
  order.by  = timesNAomit,
  frequency = 24
)


plotData <- cbind(load.ts, temperature.ts)

library(ggplot2)
ggplot(plotData, aes(timesNAomit)) + 
  geom_line(aes(y = load.ts, colour = "Load")) + 
  geom_line(aes(y = temperature.ts, colour = "Temperature"))+
  labs(title= "Correlation of load and temperature",
     y="Value", x = "Year")


```

## Forecast

With the Forecast library we can do a lot of cool stuff. The data has to be on TS format.
Here we focus on the load data. 
```{r chunk 4}
library(forecast)
library(xts)

setwd("~/Documents/Skóli/École Polytechnique/Data Analysis and Unsupervised Learning /Project/Data")
TS <- read.csv("TS.csv")
row.names(TS) <- TS$datetime
TS <- TS[,3:22]
colnames(TS) <-  c("Z1", "Z2", "Z3", "Z4", "Z5", "Z6", "Z7", "Z8", "Z9", 
                      "Z10", "Z11", "Z12" ,"Z13", "Z14", "Z15", "Z16", "Z17", "Z18", "Z19", "Z20")

TS <- TS[1] #ONly zone1
#TS
startDay <- as.POSIXct(row.names(TS)[1], format = "%Y-%m-%d %H:%M:")
load.ts <- ts(TS, start = as.numeric(startDay), frequency = 24) #This time seires gives time/date as a number, not right

class(load.ts)
head(load.ts)
summary(load.ts)

#ZOO
times <- as.POSIXct(row.names(TS), format = "%Y-%m-%d %H:%M:")
load.zoo <- as.zoo(
  x         = TS,
  order.by  = times,
  frequency = 24
)
class(load.zoo)
head(load.zoo)
summary(load.zoo)

```
We now have the data on xts format so we can use the forecast library on the TS.



```{r chunk 5}



gglagplot(load.ts, do.lines = FALSE, set.lags = 1:30)


```

```{r chunk 4.5}
ggAcf(load.ts)
ggAcf(load.ts, na.action = na.pass, lag.max = 24*35)

```
There seems to be a seasonal period of 24 hours. Also, when lags are increased there seem to be another seasonal period of 7 days.
Now to partial autocorrelation.
```{r chunk 6}
ggAcf(load.ts, type = "partial")
ggAcf(load.ts, type = "partial", lag.max = 24*7)
ggAcf(load.ts, type = "partial", lag.max = 24*7*4)

ggAcf(load.ts, plot=FALSE)
ggAcf(load.ts, type = "partial", plot=FALSE)

plot(diff(load.ts))
```


There is a significant partial autocorrelation on lag 1, 2, 3, 13:17, 24,25, and 26. When the lag is higher, there seems to be partial autocorrelation every 24 hours and every 7 days, confirming a seasonal period of 24 hours as well as a weekly seasonal period.



```{r chunk 7}

autoplot(load.zoo[1:24], main="24 hours from baseline")
autoplot(load.zoo[1:24*7], main="week from baseline")
autoplot(load.zoo[1:24*7*4], main="month from baseline")



```

First plot:

Second plot: the roughness of the plot is due to the seasonal period of 24 hours. But on this plot we can see that the load is more at the end of the week.

Third plot: 






